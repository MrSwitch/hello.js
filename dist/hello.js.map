{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/tricks/array/diff.js","node_modules/tricks/array/find.js","node_modules/tricks/array/toArray.js","node_modules/tricks/array/unique.js","node_modules/tricks/browser/agent/Storage.js","node_modules/tricks/browser/agent/cookieStorage.js","node_modules/tricks/browser/agent/localStorage.js","node_modules/tricks/browser/agent/sessionStorage.js","node_modules/tricks/browser/http/formpost.js","node_modules/tricks/browser/http/getScript.js","node_modules/tricks/browser/http/jsonp.js","node_modules/tricks/browser/http/request.js","node_modules/tricks/browser/http/xhr.js","node_modules/tricks/dom/append.js","node_modules/tricks/dom/attr.js","node_modules/tricks/dom/createElement.js","node_modules/tricks/dom/domInstance.js","node_modules/tricks/dom/each.js","node_modules/tricks/dom/hiddenFrame.js","node_modules/tricks/dom/isDom.js","node_modules/tricks/events/createEvent.js","node_modules/tricks/events/emit.js","node_modules/tricks/events/globalCallback.js","node_modules/tricks/events/on.js","node_modules/tricks/object/args.js","node_modules/tricks/object/clone.js","node_modules/tricks/object/diffKey.js","node_modules/tricks/object/extend.js","node_modules/tricks/object/instanceOf.js","node_modules/tricks/object/isBinary.js","node_modules/tricks/object/isEmpty.js","node_modules/tricks/object/merge.js","node_modules/tricks/object/pubsub.js","node_modules/tricks/object/rewire.js","node_modules/tricks/object/tryCatch.js","node_modules/tricks/object/until.js","node_modules/tricks/string/createUrl.js","node_modules/tricks/string/extract.js","node_modules/tricks/string/jsonParse.js","node_modules/tricks/string/param.js","node_modules/tricks/string/queryparse.js","node_modules/tricks/string/querystringify.js","node_modules/tricks/string/random.js","node_modules/tricks/support/cors.js","node_modules/tricks/time/setImmediate.js","node_modules/tricks/window/close.js","node_modules/tricks/window/popup.js","node_modules/tricks/window/url.js","src/hello.js"],"names":["f","exports","module","define","amd","window","global","self","this","hello","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","1","b","filter","item","indexOf","arr","callback","thisArg","arguments","undefined","value","obj","Array","prototype","slice","isArray","index","Storage","method","native","extend","api","bind","jsonParse","name","_typeof","x","getItem","removeItem","setItem","JSON","stringify","arrayFind","key","m","document","cookie","split","replace","substr","sessionStorage","temp","storage","localStorage","cookieStorage","createFrame","callback_name","frame","createElement","attr","id","style","body","appendChild","createFormFromData","data","form","reenableAfterSubmit","domInstance","toArray","elements","forEach","input","setAttribute","disabled","type","encoding","enctype","hasOwnProperty","on","setImmediate","append","parentNode","removeChild","el","inputs","instanceOf","NodeList","innerHTML","innerText","getAttribute","push","globalCallback","emit","url","options","timeout","timer","bool","cb","clearTimeout","callbackonload","onload","response","message","setTimeout","RegExp","target","action","submit","createEvent","head","getElementsByTagName","script","src","onerror","onreadystatechange","test","readyState","async","insertBefore","firstChild","getScript","MATCH_CALLBACK_PLACEHOLDER","result","json","jsonp","xhr","formpost","SupportCORS","createUrl","p","uri","query","qs","toLowerCase","proxyHandler","responseType","headers","onprogress","upload","onuploadprogress","callbackID","redirect_uri","state","opts","error","toFormData","FormData","HTMLInputElement","files","Blob","extract","tryCatch","rewire","match_headers","XMLHttpRequest","toUpperCase","responseText","responseJSON","getAllResponseHeaders","statusCode","status","File","open","overrideMimeType","setRequestHeader","send","tagName","prop","parent","elm","each","props","element","attrs","Element","Object","String","Number","isDom","matches","querySelectorAll","param","position","left","bottom","height","width","_HTMLElement","HTMLElement","_HTMLDocument","HTMLDocument","Document","_Window","constructor","dict","bubbles","cancelable","eventname","Event","initEvent","dispatchEvent","handle","guid","_len","args","_key","apply","random","prefix","SEPERATOR","supportsPassive","defineProperty","get","addEventListener","eventnames","passive","isBinary","clone","Date","map","_clone","root","HTMLInput","FileList","unshift","evt","_this2","separator","events","concat","off","findEvents","_this","emitAfter","_this3","_len2","_key2","triggerCallback","handler","utils","fn","defer","Promise","accept","reject","resolved","curry","resolve","resp","_accept","_reject","tick","querystringify","isEmpty","params","formatFunction","reg","encodeURIComponent","str","match","match_params","exec","parse","hash","delimiter","seperator","keys","join","trim_left","decodeURIComponent","formatter","parseInt","Math","toString","frameElement","close","generatePosition","_ref","_ref2","_slicedToArray","Position","Dimension","dimension","dualScreenPos","screen","d","documentElement","dimensions","path","URL","Function","location","href","cloneNode","argmap","closeWindow","diffKey","diff","iframe","merge","popup","pubsub","request","store","unique","Url","Until","use","service","create","settings","default_service","init","services","login","encodeFunction","filterEmpty","promise","next","network","provider","callbackId","prs","redirectUri","oauth","response_type","grant","display","session","SCOPE_SPLIT","scope","scopeMap","scope_map","scope_delim","force","access_token","expires","getTime","page_uri","version","refresh_token","oauth_proxy","auth","win","closed","race","then","stop","logout","authResponse","promiseLogout","_opts","err","getAuthResponse","responseHandler","authCallback","redirect","assign","search","oauth_token","expires_in","error_message","error_description","res","oauth_redirect","oldSessions","expired","CURRENT_TIME","oldSess","eventName","refresh","_callee3","_len3","_key3","proxy","formatResponse","actions","delete","default","sign","proxy_response_type","defaults","val","base","success","wrap","paging","opener"],"mappings":"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","file":"hello.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports = (a, b) => b.filter(item => a.indexOf(item) === -1);\n","// Array find\n// Returns the first non undefined response\n// If the response is (Boolean) True, then the value of that array item is returned instead...\nmodule.exports = (arr, callback, thisArg = null) => {\n\tfor (let i = 0; i < arr.length; i++) {\n\t\tconst value = callback.call(thisArg, arr[i]);\n\t\tif (value !== undefined) {\n\t\t\treturn value === true ? arr[i] : value;\n\t\t}\n\t}\n};\n","module.exports = obj => Array.prototype.slice.call(obj);\n","module.exports = a => {\n\tif (!Array.isArray(a)) {\n\t\treturn [];\n\t}\n\n\t// Is this the first location of item\n\treturn a.filter((item, index) => a.indexOf(item) === index);\n};\n","const jsonParse = require('../../string/jsonParse.js');\nconst extend = require('../../object/extend.js');\n\n// Return handler\nmodule.exports = Storage;\n\nfunction Storage(method) {\n\n\tthis.native = method;\n\n\treturn extend(this.api.bind(this), this);\n}\n\nStorage.prototype.api = function(name, value) {\n\t// recursive\n\tif (typeof name === 'object') {\n\t\tfor (const x in name) {\n\t\t\tthis.api(x, name[x]);\n\t\t}\n\t}\n\n\t// Local storage\n\telse if (!name) {\n\t\tthrow 'agent/store must have a valid name';\n\t}\n\telse if (value === undefined) {\n\t\treturn this.getItem(name);\n\t}\n\telse if (value === null) {\n\t\tthis.removeItem(name);\n\t}\n\telse {\n\t\tthis.setItem(name, value);\n\t}\n};\n\nStorage.prototype.getItem = function(name) {\n\treturn jsonParse(this.native.getItem(name));\n};\n\nStorage.prototype.setItem = function(name, value) {\n\tthis.native.setItem(name, JSON.stringify(value));\n};\n\nStorage.prototype.removeItem = function(name) {\n\tthis.native.removeItem(name);\n};\n","// Provide an API for setting and retrieving cookies\nconst arrayFind = require('../../array/find.js');\nconst Storage = require('./Storage.js');\n\n// Emulate localStorage using cookies\nmodule.exports = new Storage({\n\tgetItem: name => {\n\t\tconst key = `${name }=`;\n\t\tconst m = document.cookie.split(';');\n\t\treturn arrayFind(m, item => {\n\t\t\titem = item.replace(/(^\\s+|\\s+$)/, '');\n\t\t\tif (item && item.indexOf(key) === 0) {\n\t\t\t\treturn item.substr(key.length);\n\t\t\t}\n\t\t}) || null;\n\n\t},\n\n\tsetItem: (name, value) => {\n\t\tdocument.cookie = `${name }=${ value}`;\n\t},\n\n\tremoveItem: name => {\n\t\tdocument.cookie = `${name }=; expires=Thu, 01 Jan 1970 00:00:01 GMT;`;\n\t}\n});\n","// sessionStorage\n// Shimmed up sessionStorage\n\nconst sessionStorage = require('./sessionStorage.js');\nconst Storage = require('./Storage.js');\n\n// Test the environment\ntry {\n\tconst temp = '__tricks_temp__';\n\t// In Chrome with cookies blocked, calling localStorage throws an error\n\tconst storage = window.localStorage;\n\tstorage.setItem(temp, 1);\n\tstorage.removeItem(temp);\n\tmodule.exports = new Storage(storage);\n\n}\ncatch (e) {\n\tmodule.exports = sessionStorage;\n}\n","// sessionStorage\n// Shimmed up sessionStorage\n\nconst cookieStorage = require('./cookieStorage.js');\nconst Storage = require('./Storage.js');\n\n// Test the environment\ntry {\n\tconst temp = '__tricks_temp__';\n\t// In Chrome with cookies blocked, calling localStorage throws an error\n\tconst storage = window.sessionStorage;\n\tstorage.setItem(temp, 1);\n\tstorage.removeItem(temp);\n\tmodule.exports = new Storage(storage);\n\n}\ncatch (e) {\n\tmodule.exports = cookieStorage;\n}\n","// Post\n// Send information to a remote location using the post mechanism\n// @param string uri path\n// @param object data, key value data to send\n// @param function callback, function to execute in response\n\nconst append = require('../../dom/append.js');\nconst attr = require('../../dom/attr.js');\nconst domInstance = require('../../dom/domInstance.js');\nconst createElement = require('../../dom/createElement.js');\nconst globalCallback = require('../../events/globalCallback.js');\nconst toArray = require('../../array/toArray.js');\nconst instanceOf = require('../../object/instanceOf.js');\nconst on = require('../../events/on.js');\nconst emit = require('../../events/emit.js');\nconst setImmediate = require('../../time/setImmediate.js');\n\nmodule.exports = (url, data, options, callback, callback_name, timeout = 60000) => {\n\n\tlet timer;\n\tlet bool = 0;\n\tconst cb = r => {\n\t\tif (!(bool++)) {\n\t\t\tif (timer) {\n\t\t\t\tclearTimeout(timer);\n\t\t\t\ttimer = null;\n\t\t\t}\n\t\t\tcallback(r);\n\n\t\t\t// Trigger onsubmit on the form.\n\t\t\t// Typically this isn't activated until afterwards\n\t\t\temit(form, 'submit');\n\n\t\t\t// The setImmediate fixes the test runner in phantomjs\n\t\t\tsetImmediate(() => frame.parentNode.removeChild(frame));\n\t\t}\n\n\t\treturn true;\n\t};\n\n\t// What is the name of the callback to contain\n\t// We'll also use this to name the iframe\n\tcallback_name = globalCallback(cb, callback_name);\n\n\t/////////////////////\n\t// Create the FRAME\n\t/////////////////////\n\n\tconst frame = createFrame(callback_name);\n\n\t// Override callback mechanism. Triggger a response onload/onerror\n\tif (options && options.callbackonload) {\n\n\t\t// Onload is being fired twice\n\t\tframe.onload = cb.bind(null, {\n\t\t\tresponse: 'posted',\n\t\t\tmessage: 'Content was posted'\n\t\t});\n\t}\n\n\n\t/////////////////////\n\t// Set a timeout\n\t/////////////////////\n\n\tif (timeout) {\n\t\ttimer = setTimeout(cb.bind(null, new Error('timeout')), timeout);\n\t}\n\n\n\t/////////////////////\n\t// Create a form\n\t/////////////////////\n\n\tconst form = createFormFromData(data);\n\n\t// The URL is a function for some cases and as such\n\t// Determine its value with a callback containing the new parameters of this function.\n\turl = url.replace(new RegExp('=\\\\?(&|$)'), `=${ callback_name }$1`);\n\n\t// Set the target of the form\n\tattr(form, {\n\t\tmethod: 'POST',\n\t\ttarget: callback_name,\n\t\taction: url\n\t});\n\n\tform.target = callback_name;\n\n\t// Submit the form\n\t// Some reason this needs to be offset from the current window execution\n\tsetTimeout(() => {\n\t\tform.submit();\n\t}, 100);\n};\n\n\nfunction createFrame(callback_name) {\n\tlet frame;\n\n\ttry {\n\t\t// IE7 hack, only lets us define the name here, not later.\n\t\tframe = createElement(`<iframe name=\"${ callback_name }\">`);\n\t}\n\tcatch (e) {\n\t\tframe = createElement('iframe');\n\t}\n\n\t// Attach the frame with the following attributes to the document body.\n\tattr(frame, {\n\t\tname: callback_name,\n\t\tid: callback_name,\n\t\tstyle: 'display:none;'\n\t});\n\n\tdocument.body.appendChild(frame);\n\n\treturn frame;\n}\n\n\nfunction createFormFromData(data) {\n\n\t// This hack needs a form\n\tlet form = null;\n\tconst reenableAfterSubmit = [];\n\tlet i = 0;\n\tlet x = null;\n\n\n\t// If we are just posting a single item\n\tif (domInstance('input', data)) {\n\t\t// Get the parent form\n\t\tform = data.form;\n\n\t\t// Loop through and disable all of its siblings\n\t\ttoArray(form.elements).forEach(input => {\n\t\t\tif (input !== data) {\n\t\t\t\tinput.setAttribute('disabled', true);\n\t\t\t}\n\t\t});\n\n\t\t// Move the focus to the form\n\t\tdata = form;\n\t}\n\n\t// Posting a form\n\tif (domInstance('form', data)) {\n\t\t// This is a form element\n\t\tform = data;\n\n\t\t// Does this form need to be a multipart form?\n\t\ttoArray(form.elements).forEach(input => {\n\t\t\tif (!input.disabled && input.type === 'file') {\n\t\t\t\tform.encoding = form.enctype = 'multipart/form-data';\n\t\t\t\tinput.setAttribute('name', 'file');\n\t\t\t}\n\t\t});\n\t}\n\telse {\n\t\t// Its not a form element,\n\t\t// Therefore it must be a JSON object of Key=>Value or Key=>Element\n\t\t// If anyone of those values are a input type=file we shall shall insert its siblings into the form for which it belongs.\n\t\tfor (x in data) if (data.hasOwnProperty(x)) {\n\t\t\t// Is this an input Element?\n\t\t\tif (domInstance('input', data[x]) && data[x].type === 'file') {\n\t\t\t\tform = data[x].form;\n\t\t\t\tform.encoding = form.enctype = 'multipart/form-data';\n\t\t\t}\n\t\t}\n\n\t\t// Do If there is no defined form element, lets create one.\n\t\tif (!form) {\n\t\t\t// Build form\n\t\t\tform = append('form');\n\n\t\t\t// Bind the removal of the form\n\t\t\ton(form, 'submit', () => {\n\t\t\t\tsetImmediate(() => {\n\t\t\t\t\tform.parentNode.removeChild(form);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\t// Bind the clean up of the existing form.\n\t\t\ton(form, 'submit', () => {\n\t\t\t\tsetImmediate(() => {\n\t\t\t\t\treenableAfterSubmit.forEach(input => {\n\t\t\t\t\t\tif (input) {\n\t\t\t\t\t\t\tinput.setAttribute('disabled', false);\n\t\t\t\t\t\t\tinput.disabled = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Reset, incase this is called again.\n\t\t\t\t\treenableAfterSubmit.length = 0;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tlet input;\n\n\t\t// Add elements to the form if they dont exist\n\t\tfor (x in data) if (data.hasOwnProperty(x)) {\n\n\t\t\t// Is this an element?\n\t\t\tconst el = (domInstance('input', data[x]) || domInstance('textArea', data[x]) || domInstance('select', data[x]));\n\n\t\t\t// Is this not an input element, or one that exists outside the form.\n\t\t\tif (!el || data[x].form !== form) {\n\n\t\t\t\t// Does an element have the same name?\n\t\t\t\tlet inputs = form.elements[x];\n\t\t\t\tif (input) {\n\t\t\t\t\t// Remove it.\n\t\t\t\t\tif (!instanceOf(inputs, window.NodeList)) {\n\t\t\t\t\t\tinputs = [inputs];\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (i = 0; i < inputs.length; i++) {\n\t\t\t\t\t\tinputs[i].parentNode.removeChild(inputs[i]);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// Create an input element\n\t\t\t\tinput = append('input', {\n\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\tname: x\n\t\t\t\t}, form);\n\n\t\t\t\t// Does it have a value attribute?\n\t\t\t\tif (el) {\n\t\t\t\t\tinput.value = data[x].value;\n\t\t\t\t}\n\t\t\t\telse if (domInstance(null, data[x])) {\n\t\t\t\t\tinput.value = data[x].innerHTML || data[x].innerText;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tinput.value = data[x];\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// It is an element, which exists within the form, but the name is wrong\n\t\t\telse if (el && data[x].name !== x) {\n\t\t\t\tdata[x].setAttribute('name', x);\n\t\t\t\tdata[x].name = x;\n\t\t\t}\n\t\t}\n\n\t\t// Disable elements from within the form if they weren't specified\n\t\ttoArray(form.elements).forEach(input => {\n\n\t\t\t// Does the same name and value exist in the parent\n\t\t\tif (!(input.name in data) && input.getAttribute('disabled') !== true) {\n\t\t\t\t// Disable\n\t\t\t\tinput.setAttribute('disabled', true);\n\n\t\t\t\t// Add re-enable to callback\n\t\t\t\treenableAfterSubmit.push(input);\n\t\t\t}\n\t\t});\n\t}\n\n\treturn form;\n}\n","const createElement = require('../../dom/createElement.js');\nconst createEvent = require('../../events/createEvent.js');\n\nmodule.exports = (url, callback, timeout = 0) => {\n\n\t// Inject a script tag\n\tlet bool = 0;\n\tlet timer;\n\tconst head = document.getElementsByTagName('script')[0].parentNode;\n\tconst cb = e => {\n\t\tif (!(bool++) && callback) {\n\t\t\tcallback(e);\n\t\t}\n\t\tif (timer) {\n\t\t\tclearTimeout(timer);\n\t\t}\n\t};\n\n\t// Add timeout\n\tif (timeout) {\n\t\ttimer = window.setTimeout(() => {\n\t\t\tcb(createEvent('timeout'));\n\t\t}, timeout);\n\t}\n\n\t// Build script tag\n\tconst script = createElement('script', {\n\t\tsrc: url,\n\t\tonerror: cb,\n\t\tonload: cb,\n\t\tonreadystatechange: () => {\n\t\t\tif (/loaded|complete/i.test(script.readyState)) {\n\t\t\t\tcb(createEvent('load'));\n\t\t\t}\n\t\t}\n\t});\n\n\t// Set Async\n\tscript.async = true;\n\n\t// Inject script tag into the head element\n\thead.insertBefore(script, head.firstChild);\n\n\treturn script;\n};\n","// JSONP\nconst globalCallback = require('../../events/globalCallback.js');\nconst getScript = require('./getScript.js');\n\nconst MATCH_CALLBACK_PLACEHOLDER = /=\\?(&|$)/;\n\nmodule.exports = (url, callback, callback_name, timeout = 60000) => {\n\n\t// Change the name of the callback\n\tlet result;\n\n\t// Add callback to the window object\n\tcallback_name = globalCallback(json => {\n\t\tresult = json;\n\t\treturn true; // this ensure the window reference is removed\n\t}, callback_name);\n\n\t// The URL is a function for some cases and as such\n\t// Determine its value with a callback containing the new parameters of this function.\n\turl = url.replace(MATCH_CALLBACK_PLACEHOLDER, `=${ callback_name }$1`);\n\n\tconst script = getScript(url, () => {\n\t\tcallback(result);\n\t\tscript.parentNode.removeChild(script);\n\t}, timeout);\n\n\treturn script;\n};\n","// Request\n// Makes an REST request given an object which describes how (aka, xhr, jsonp, formpost)\nconst jsonp = require('./jsonp.js');\nconst xhr = require('./xhr.js');\nconst formpost = require('./formpost.js');\nconst SupportCORS = require('../../support/cors.js');\nconst globalCallback = require('../../events/globalCallback.js');\nconst createUrl = require('../../string/createUrl.js');\nconst extend = require('../../object/extend.js');\n\nmodule.exports = (p, callback) => {\n\n\tif (typeof p === 'string') {\n\t\tp = {\n\t\t\turl: p\n\t\t};\n\t}\n\n\t// Use interchangeably\n\tp.url = p.url || p.uri;\n\n\t// Set defaults\n\tp.query = p.query || p.qs || {};\n\n\t// Default method\n\tp.method = (p.method || 'get').toLowerCase();\n\n\t// Default proxy response\n\tp.proxyHandler = p.proxyHandler || ((p, cb) => {\n\t\tcb();\n\t});\n\n\t// CORS\n\tif (SupportCORS && (typeof (p.xhr) === 'function' ? p.xhr(p, p.query) : p.xhr !== false)) {\n\n\t\t// Pass the selected request through a proxy\n\t\tp.proxyHandler(p, () => {\n\t\t\t// The agent and the provider support CORS\n\t\t\tconst url = createUrl(p.url, p.query);\n\t\t\tconst x = xhr(p.method, url, p.responseType, p.headers, p.data, callback);\n\t\t\tx.onprogress = p.onprogress || null;\n\n\t\t\t// Feature detect, not available on all implementations of XMLHttpRequest\n\t\t\tif (x.upload && p.onuploadprogress) {\n\t\t\t\tx.upload.onprogress = p.onuploadprogress;\n\t\t\t}\n\t\t});\n\n\t\treturn;\n\t}\n\n\t// Apply a globalCallback\n\tp.callbackID = p.query.callback = globalCallback(callback);\n\n\t// JSONP\n\tif (p.jsonp !== false) {\n\n\t\t// Call p.jsonp handler\n\t\tif (typeof (p.jsonp) === 'function') {\n\t\t\t// Format the request via JSONP\n\t\t\tp.jsonp(p, p.query);\n\t\t}\n\n\t\t// Lets use JSONP if the method is 'get'\n\t\tif (p.method === 'get') {\n\n\t\t\tp.proxyHandler(p, () => {\n\t\t\t\tconst url = createUrl(p.url, extend(p.query, p.data || {}));\n\t\t\t\tjsonp(url, callback, p.callbackID, p.timeout);\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\t}\n\n\t// Otherwise we're on to the old school, iframe hacks and JSONP\n\tif (p.form !== false) {\n\n\t\t// Add some additional query parameters to the URL\n\t\t// We're pretty stuffed if the endpoint doesn't like these\n\t\tp.query.redirect_uri = p.redirect_uri;\n\t\tp.query.state = JSON.stringify({callback: p.callbackID});\n\t\tdelete p.query.callback;\n\n\t\tlet opts;\n\n\t\tif (typeof (p.form) === 'function') {\n\n\t\t\t// Format the request\n\t\t\topts = p.form(p, p.query);\n\t\t}\n\n\t\tif (p.method === 'post' && opts !== false) {\n\n\t\t\tp.proxyHandler(p, () => {\n\t\t\t\tconst url = createUrl(p.url, p.query);\n\t\t\t\tformpost(url, p.data, opts, callback, p.callbackID, p.timeout);\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\t}\n\n\tcallback({error: 'invalid_request'});\n};\n","// XHR: uses CORS to make requests\nconst instanceOf = require('../../object/instanceOf.js');\nconst extract = require('../../string/extract.js');\nconst jsonParse = require('../../string/jsonParse.js');\nconst tryCatch = require('../../object/tryCatch.js');\nconst rewire = require('../../object/rewire.js');\n\nconst match_headers = /([a-z0-9-]+):\\s*(.*);?/gi;\n\nmodule.exports = rewire(xhr);\n\nfunction xhr(method, url, responseType, headers, data, callback) {\n\n\tconst r = new XMLHttpRequest();\n\n\t// Make it CAPITAL\n\tmethod = method.toUpperCase();\n\n\t// Define the callback function\n\tr.onload = () => {\n\t\t// Response\n\t\tlet response = r.response;\n\n\t\t// Was this text\n\t\tif (!response && (r.responseType === '' || r.responseType === 'text')) {\n\t\t\tresponse = r.responseText;\n\t\t}\n\n\t\t// Is this json?\n\t\tif (typeof(response) === 'string' && responseType === 'json') {\n\n\t\t\t// Set this to the json response\n\t\t\t// Fallback if the browser did not defined responseJSON...\n\t\t\tresponse = r.responseJSON || jsonParse(r.responseText || r.response);\n\t\t}\n\n\t\tconst headers = extract(r.getAllResponseHeaders(), match_headers);\n\t\theaders.statusCode = r.status;\n\n\t\tcallback(response, headers);\n\t};\n\n\tr.onerror = r.onload;\n\n\t// Should we add the query to the URL?\n\tif (method === 'GET' || method === 'DELETE') {\n\t\tdata = null;\n\t}\n\telse if (data && typeof (data) !== 'string' &&\n\t\t!instanceOf(data, window.FormData) &&\n\t\t!instanceOf(data, window.File) &&\n\t\t!instanceOf(data, window.Blob))\t{\n\t\t// Loop through and add formData\n\t\tdata = toFormData(data);\n\t}\n\n\t// Open the path, async\n\tr.open(method, url, true);\n\n\t// Set responseType if supported\n\tif ('responseType' in r) {\n\n\t\ttryCatch(() => {\n\t\t\t// Setting this to an unsupported value can result in a \"SYNTAX_ERR: DOM Exception 12\"\n\t\t\tr.responseType = responseType;\n\t\t});\n\t}\n\telse if (responseType === 'blob') {\n\t\tr.overrideMimeType('text/plain; charset=x-user-defined');\n\t}\n\n\t// Set any bespoke headers\n\tif (headers) {\n\t\tfor (const x in headers) {\n\t\t\tr.setRequestHeader(x, headers[x]);\n\t\t}\n\t}\n\n\tr.send(data);\n\n\treturn r;\n}\n\n\nfunction toFormData(data) {\n\tconst f = new FormData();\n\tfor (const x in data) {\n\t\tif (data.hasOwnProperty(x)) {\n\t\t\tif (instanceOf(data[x], window.HTMLInputElement) && 'files' in data[x]) {\n\t\t\t\tif (data[x].files.length > 0) {\n\t\t\t\t\tf.append(x, data[x].files[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (instanceOf(data[x], window.Blob)) {\n\t\t\t\tf.append(x, data[x], data.name);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tf.append(x, data[x]);\n\t\t\t}\n\t\t}\n\t}\n\treturn f;\n}\n","const createElement = require('./createElement.js');\n\nmodule.exports = (tagName, prop, parent = document.body) => {\n\tconst elm = createElement(tagName, prop);\n\tparent.appendChild(elm);\n\treturn elm;\n};\n","const each = require('./each.js');\n\nmodule.exports = (elements, props) =>\n\teach(elements, element => {\n\t\tfor (const x in props) {\n\t\t\tconst prop = props[x];\n\t\t\tif (typeof prop === 'function') {\n\t\t\t\telement[x] = prop;\n\t\t\t}\n\t\t\telse {\n\t\t\t\telement.setAttribute(x, prop);\n\t\t\t}\n\t\t}\n\t});\n","const attr = require('./attr.js');\n\nmodule.exports = (tagName, attrs) => {\n\tconst elm = document.createElement(tagName);\n\tattr(elm, attrs);\n\treturn elm;\n};\n","const instanceOf = require('../object/instanceOf.js');\n\nmodule.exports = (type, data) => {\n\tconst test = `HTML${ (type || '').replace(\n\t\t/^[a-z]/,\n\t\tm => m.toUpperCase()\n\t)}Element`;\n\n\tif (!data) {\n\t\treturn false;\n\t}\n\n\tif (window[test]) {\n\t\treturn instanceOf(data, window[test]);\n\t}\n\telse if (window.Element) {\n\t\treturn instanceOf(data, window.Element) && (!type || (data.tagName && data.tagName.toLowerCase() === type));\n\t}\n\telse {\n\t\treturn (!(instanceOf(data, Object) || instanceOf(data, Array) || instanceOf(data, String) || instanceOf(data, Number)) && data.tagName && data.tagName.toLowerCase() === type);\n\t}\n};\n","const isDom = require('./isDom.js');\nconst instanceOf = require('../object/instanceOf.js');\nconst toArray = require('../array/toArray.js');\n\nmodule.exports = (matches, callback = () => {}) => {\n\n\tif (isDom(matches)) {\n\t\tmatches = [matches];\n\t}\n\telse if (typeof(matches) === 'string') {\n\t\tmatches = document.querySelectorAll(matches);\n\t}\n\n\tif (!instanceOf(matches, Array)) {\n\t\tmatches = toArray(matches);\n\t}\n\n\tif (callback) {\n\t\tmatches.forEach(callback);\n\t}\n\n\treturn matches;\n};\n","const append = require('./append.js');\nconst param = require('../string/param.js');\n\nmodule.exports = src => {\n\n\tconst style = param({\n\t\tposition: 'absolute',\n\t\tleft: '-1000px',\n\t\tbottom: 0,\n\t\theight: '1px',\n\t\twidth: '1px'\n\t}, ';', ':');\n\n\treturn append('iframe', {src, style});\n};\n","const instanceOf = require('../object/instanceOf.js');\n\nconst _HTMLElement = typeof HTMLElement !== 'undefined' ? HTMLElement : Element;\nconst _HTMLDocument = typeof HTMLDocument !== 'undefined' ? HTMLDocument : Document;\nconst _Window = window.constructor;\n\nmodule.exports = test =>\n\tinstanceOf(test, _HTMLElement) ||\n\t\tinstanceOf(test, _HTMLDocument) ||\n\t\tinstanceOf(test, _Window)\n;\n","// IE does not support `new Event()`\n// See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Creating_and_triggering_events for details\nconst dict = {bubbles: true, cancelable: true};\n\nlet createEvent = (eventname, options = dict) =>\n\tnew Event(eventname, options);\n\ntry {\n\tcreateEvent('test');\n}\ncatch (e) {\n\tcreateEvent = (eventname, options = dict) => {\n\t\tconst e = document.createEvent('Event');\n\t\te.initEvent(eventname, !!options.bubbles, !!options.cancelable);\n\t\treturn e;\n\t};\n}\n\nmodule.exports = createEvent;\n","// on.js\n// Listen to events, this is a wrapper for addEventListener\nconst each = require('../dom/each.js');\nconst createEvent = require('./createEvent.js');\n\n// Return\nmodule.exports = (elements, eventname) => each(elements, el => el.dispatchEvent(createEvent(eventname)));\n\n","// Global Events\n// Attach the callback to the window object\n// Return its unique reference\nconst random = require('../string/random.js');\n\nmodule.exports = (callback, guid, prefix = '_tricks_') => {\n\n\t// If the guid has not been supplied then create a new one.\n\tguid = guid || prefix + random();\n\n\t// Define the callback function\n\twindow[guid] = handle.bind(null, guid, callback);\n\n\treturn guid;\n};\n\nfunction handle(guid, callback, ...args) {\n\tcallback(...args) && delete window[guid];\n}\n","// on.js\n// Listen to events, this is a wrapper for addEventListener\n\nconst each = require('../dom/each.js');\nconst SEPERATOR = /[\\s,]+/;\n\n// See https://github.com/WICG/EventListenerOptions/blob/gh-pages/explainer.md#feature-detection\nlet supportsPassive = false;\ntry {\n\tconst opts = Object.defineProperty({}, 'passive', {\n\t\tget() {\n\t\t\tsupportsPassive = true;\n\t\t}\n\t});\n\twindow.addEventListener('test', null, opts);\n}\ncatch (e) {\n\t// Continue\n}\n\n\nmodule.exports = (elements, eventnames, callback, options = false) => {\n\n\tif (typeof options === 'object' && options.passive && !supportsPassive) {\n\t\t// Override the passive mark\n\t\toptions = false;\n\t}\n\n\teventnames = eventnames.split(SEPERATOR);\n\treturn each(elements, el => eventnames.forEach(eventname => el.addEventListener(eventname, callback, options)));\n};\n","// Makes it easier to assign parameters, where some are optional\n// @param o object\n// @param a arguments\nmodule.exports = (o, args) => {\n\n\tconst p = {};\n\tlet i = 0;\n\tlet t = null;\n\tlet x = null;\n\n\t// 'x' is the first key in the list of object parameters\n\tfor (x in o) {\n\t\tif (o.hasOwnProperty(x)) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Passing in hash object of arguments?\n\t// Where the first argument can't be an object\n\tif ((args.length === 1) && (typeof (args[0]) === 'object') && o[x] !== 'o!') {\n\n\t\t// Could this object still belong to a property?\n\t\t// Check the object keys if they match any of the property keys\n\t\tfor (x in args[0]) {\n\t\t\tif (o.hasOwnProperty(x)) {\n\t\t\t\t// Does this key exist in the property list?\n\t\t\t\tif (x in o) {\n\t\t\t\t\t// Yes this key does exist so its most likely this function has been invoked with an object parameter\n\t\t\t\t\t// Return first argument as the hash of all arguments\n\t\t\t\t\treturn args[0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Else loop through and account for the missing ones.\n\tfor (x in o) {\n\t\tif (o.hasOwnProperty(x)) {\n\n\t\t\tt = typeof (args[i]);\n\n\t\t\tif ((typeof (o[x]) === 'function' && o[x].test(args[i])) || (typeof (o[x]) === 'string' && (\n\t\t\t\t(o[x].indexOf('s') > -1 && t === 'string') ||\n\t\t\t\t(o[x].indexOf('o') > -1 && t === 'object') ||\n\t\t\t\t(o[x].indexOf('i') > -1 && t === 'number') ||\n\t\t\t\t(o[x].indexOf('a') > -1 && t === 'object') ||\n\t\t\t\t(o[x].indexOf('f') > -1 && t === 'function')\n\t\t\t))\n\t\t\t) {\n\t\t\t\tp[x] = args[i++];\n\t\t\t}\n\n\t\t\telse if (typeof (o[x]) === 'string' && o[x].indexOf('!') > -1) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn p;\n};\n","const isBinary = require('./isBinary.js');\n\n// Create a clone of an object\nmodule.exports = function clone(obj) {\n\t// Does not clone DOM elements, nor Binary data, e.g. Blobs, Filelists\n\tif (obj === null || typeof (obj) !== 'object' || obj instanceof Date || 'nodeName' in obj || isBinary(obj) || (typeof FormData === 'function' && obj instanceof FormData)) {\n\t\treturn obj;\n\t}\n\n\tif (Array.isArray(obj)) {\n\t\t// Clone each item in the array\n\t\treturn obj.map(clone.bind(this));\n\t}\n\n\t// But does clone everything else.\n\tconst _clone = {};\n\tfor (const x in obj) {\n\t\t_clone[x] = clone(obj[x]);\n\t}\n\n\treturn _clone;\n};\n","// Return all the properties in 'a' which aren't in 'b';\nmodule.exports = (a, b) => {\n\tif (a || !b) {\n\t\tconst r = {};\n\t\tfor (const x in a) {\n\t\t\t// is this a custom property?\n\t\t\tif (!(x in b)) {\n\t\t\t\tr[x] = a[x];\n\t\t\t}\n\t\t}\n\t\treturn r;\n\t}\n\treturn a;\n};\n","const instanceOf = require('./instanceOf.js');\n\nmodule.exports = function extend(r, ...args) {\n\targs.forEach(o => {\n\t\tif (Array.isArray(r) && Array.isArray(o)) {\n\t\t\tArray.prototype.push.apply(r, o);\n\t\t}\n\t\telse if (instanceOf(r, Object) && instanceOf(o, Object) && r !== o) {\n\t\t\tfor (const x in o) {\n\t\t\t\tr[x] = extend(r[x], o[x]);\n\t\t\t}\n\t\t}\n\t\telse if (Array.isArray(o)) {\n\t\t\t// Clone it\n\t\t\tr = o.slice(0);\n\t\t}\n\t\telse {\n\t\t\tr = o;\n\t\t}\n\t});\n\treturn r;\n};\n","module.exports = (test, root) => root && test instanceof root;\n","const instanceOf = require('./instanceOf.js');\n\nmodule.exports = data =>\n\tinstanceOf(data, Object) && (\n\t\t(instanceOf(data, typeof HTMLInputElement !== 'undefined' ? HTMLInputElement : undefined) && data.type === 'file') ||\n\t(instanceOf(data, typeof HTMLInput !== 'undefined' ? HTMLInput : undefined) && data.type === 'file') ||\n\tinstanceOf(data, typeof FileList !== 'undefined' ? FileList : undefined) ||\n\tinstanceOf(data, typeof File !== 'undefined' ? File : undefined) ||\n\tinstanceOf(data, typeof Blob !== 'undefined' ? Blob : undefined));\n","module.exports = obj => {\n\n\t// Scalar\n\tif (!obj)\n\t\treturn true;\n\n\t// Array\n\tif (Array.isArray(obj)) {\n\t\treturn !obj.length;\n\t}\n\telse if (typeof (obj) === 'object') {\n\t\t// Object\n\t\tfor (const key in obj) {\n\t\t\tif (obj.hasOwnProperty(key)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n};\n","// Extend an object\nconst extend = require('./extend.js');\n\nmodule.exports = (...args) => {\n\targs.unshift({});\n\treturn extend(...args);\n};\n","// Pubsub extension\n// A contructor superclass for adding event menthods, on, off, emit.\nconst setImmediate = require('../time/setImmediate.js');\n\nconst separator = /[\\s,]+/;\n\nmodule.exports = function() {\n\n\t// If this doesn't support getPrototype then we can't get prototype.events of the parent\n\t// So lets get the current instance events, and add those to a parent property\n\tthis.parent = {\n\t\tevents: this.events,\n\t\tfindEvents: this.findEvents,\n\t\tparent: this.parent,\n\t\tutils: this.utils\n\t};\n\n\tthis.events = {};\n\n\tthis.off = off;\n\tthis.on = on;\n\tthis.emit = emit;\n\tthis.emitAfter = emitAfter;\n\tthis.findEvents = findEvents;\n\n\treturn this;\n};\n\n\n// On, subscribe to events\n// @param evt   string\n// @param callback  function\nfunction on(evt, callback) {\n\n\tif (callback && typeof (callback) === 'function') {\n\t\tevt.split(separator).forEach(name => {\n\t\t\t// Has this event already been fired on this instance?\n\t\t\tthis.events[name] = [callback].concat(this.events[name] || []);\n\t\t});\n\t}\n\n\treturn this;\n}\n\n\n// Off, unsubscribe to events\n// @param evt   string\n// @param callback  function\nfunction off(evt, callback) {\n\n\tthis.findEvents(evt, function(name, index) {\n\t\tif (!callback || this.events[name][index] === callback) {\n\t\t\tthis.events[name][index] = null;\n\t\t}\n\t});\n\n\treturn this;\n}\n\n// Emit\n// Triggers any subscribed events\nfunction emit(evt, ...args) {\n\n\t// Append the eventname to the end of the arguments\n\targs.push(evt);\n\n\t// Handler\n\tconst handler = function(name, index) {\n\n\t\t// Replace the last property with the event name\n\t\targs[args.length - 1] = (name === '*' ? evt : name);\n\n\t\t// Trigger\n\t\tthis.events[name][index].apply(this, args);\n\t};\n\n\t// Find the callbacks which match the condition and call\n\tlet _this = this;\n\twhile (_this && _this.findEvents) {\n\n\t\t// Find events which match\n\t\t_this.findEvents(`${evt },*`, handler);\n\t\t_this = _this.parent;\n\t}\n\n\treturn this;\n}\n\n// Easy functions\nfunction emitAfter(...args) {\n\n\tsetImmediate(() => {\n\t\tthis.emit(...args);\n\t});\n\n\treturn this;\n}\n\nfunction findEvents(evt, callback) {\n\n\tconst a = evt.split(separator);\n\n\tfor (const name in this.events) {\n\t\tif (this.events.hasOwnProperty(name)) {\n\n\t\t\tif (a.indexOf(name) > -1) {\n\n\t\t\t\tthis.events[name].forEach(triggerCallback.bind(this, name, callback));\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction triggerCallback(name, callback, handler, i) {\n\t// Does the event handler exist?\n\tif (handler) {\n\t\t// Emit on the local instance of this\n\t\tcallback.call(this, name, i);\n\t}\n}\n","// Rewire functions\nmodule.exports = fn => {\n\tconst f = (...args) => f.fn.apply(null, args);\n\tf.fn = fn;\n\treturn f;\n};\n","module.exports = fn => {\n\ttry {\n\t\treturn fn.call(null);\n\t}\n\tcatch (e) {\n\t\t// Continue\n\t}\n};\n","// Polls the fn multiple times until it's resolved\n// Period between polls is defined by the value defer\nmodule.exports = (fn, defer = 0) =>\n\n\tnew Promise((accept, reject) => {\n\n\t\tlet timer;\n\t\tlet resolved;\n\n\t\tconst curry = resolve => resp => {\n\t\t\ttimer && clearTimeout(timer);\n\t\t\tresolved = true;\n\t\t\treturn resolve(resp);\n\t\t};\n\n\t\tconst _accept = curry(accept);\n\t\tconst _reject = curry(reject);\n\n\t\tconst tick = () => {\n\t\t\ttry {\n\t\t\t\tfn(_accept, _reject);\n\n\t\t\t\tif (!resolved) {\n\t\t\t\t\ttimer = setTimeout(tick, defer);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\treject(e);\n\t\t\t}\n\t\t};\n\n\t\ttick();\n\t});\n","const querystringify = require('./querystringify.js');\nconst isEmpty = require('../object/isEmpty.js');\n\nmodule.exports = (url, params, formatFunction) => {\n\n\tlet reg;\n\n\tif (params) {\n\t\t// Set default formatting function\n\t\tformatFunction = formatFunction || encodeURIComponent;\n\n\t\t// Override the items in the URL which already exist\n\t\tfor (const x in params) {\n\t\t\tconst str = `([\\\\?\\\\&])${ x }=[^\\\\&]*`;\n\t\t\treg = new RegExp(str);\n\t\t\tif (url.match(reg)) {\n\t\t\t\turl = url.replace(reg, `$1${ x }=${ formatFunction(params[x])}`);\n\t\t\t\tdelete params[x];\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!isEmpty(params)) {\n\t\treturn url + (url.indexOf('?') > -1 ? '&' : '?') + querystringify(params, formatFunction);\n\t}\n\n\treturn url;\n};\n","// Extract\n// Extract the parameters of an URL string\n// @param string s, string to decode\n\nmodule.exports = (str, match_params, formatFunction = x => x) => {\n\tconst a = {};\n\tlet m;\n\twhile ((m = match_params.exec(str))) {\n\t\ta[m[1]] = formatFunction(m[2]);\n\t}\n\treturn a;\n};\n","const tryCatch = require('../object/tryCatch.js');\nmodule.exports = str => tryCatch(() => JSON.parse(str));\n","// Param\n// Explode/encode the parameters of an URL string/object\n// @param string s, string to decode\nmodule.exports = (hash, delimiter = '&', seperator = '=', formatFunction = o => o) =>\n\tObject.keys(hash).map(name => {\n\t\tconst value = formatFunction(hash[name]);\n\t\treturn name + (value !== null ? seperator + value : '');\n\t}).join(delimiter)\n;\n","// Create a Query string\nconst extract = require('./extract.js');\n\nconst trim_left = /^[#?]/;\nconst match_params = /([^=/&]+)=([^&]+)/g;\n\nmodule.exports = (str, formatFunction = decodeURIComponent) => {\n\tstr = str.replace(trim_left, '');\n\treturn extract(str, match_params, formatFunction);\n};\n","// Create a Query string\nconst param = require('./param.js');\nconst fn = value => (value === '?' ? '?' : encodeURIComponent(value));\n\nmodule.exports = (o, formatter = fn) => param(o, '&', '=', formatter);\n","module.exports = () => parseInt(Math.random() * 1e12, 10).toString(36);\n","module.exports = ('withCredentials' in new XMLHttpRequest());\n","module.exports = typeof setImmediate === 'function' ? setImmediate : (cb => setTimeout(cb, 0));\n","// Close a window\nmodule.exports = window => {\n\n\t// Is this window within an Iframe?\n\tif (window.frameElement) {\n\t\twindow.parent.document.body.removeChild(window.frameElement);\n\t}\n\telse {\n\t\t// Close this current window\n\t\ttry {\n\t\t\twindow.close();\n\t\t}\n\t\tcatch (e) {\n\t\t\t// Continue\n\t\t}\n\n\t\t// IOS bug wont let us close a popup if still loading\n\t\tif (window.addEventListener) {\n\t\t\twindow.addEventListener('load', () => window.close());\n\t\t}\n\t}\n};\n","// popup\n// Easy options as a hash\nconst param = require('../string/param.js');\n\nconst documentElement = document.documentElement;\nconst dimensions = [['Top', 'Height'], ['Left', 'Width']];\n\nmodule.exports = (url, target, options = {}) => {\n\n\t// centers the popup correctly to the current display of a multi-screen display.\n\tdimensions.forEach(generatePosition.bind(options));\n\n\t// Open\n\treturn window.open(url, target, param(options, ','));\n};\n\nfunction generatePosition ([Position, Dimension]) {\n\tconst position = Position.toLowerCase();\n\tconst dimension = Dimension.toLowerCase();\n\tif (this[dimension] && !(position in this)) {\n\t\tconst dualScreenPos = window[`screen${ Position}`] !== undefined ? window[`screen${ Position}`] : screen[position];\n\t\tconst d = screen[dimension] || window[`inner${ Dimension}`] || documentElement[`client${ Dimension}`];\n\t\tthis[position] = parseInt((d - this[dimension]) / 2, 10) + dualScreenPos;\n\t}\n}\n","module.exports = path => {\n\n\t// If the path is empty\n\tif (!path) {\n\t\treturn window.location;\n\t}\n\n\t// Chrome and FireFox support new URL() to extract URL objects\n\telse if (window.URL && URL instanceof Function && URL.length !== 0) {\n\t\treturn new URL(path, window.location);\n\t}\n\n\t// Ugly shim, it works!\n\telse {\n\t\tconst a = document.createElement('a');\n\t\ta.href = path;\n\t\t// Return clone for IE compatibility view.\n\t\treturn a.cloneNode(false);\n\t}\n};\n","/**\n * @hello.js\n *\n * HelloJS is a client side Javascript SDK for making OAuth2 logins and subsequent REST calls.\n *\n * @author Andrew Dodson\n * @website https://adodson.com/hello.js/\n\n * @copyright Andrew Dodson, 2012 - 2015\n * @license MIT: You are free to use and modify this code for any use, on the condition that this copyright notice remains.\n */\n\nconst argmap = require('tricks/object/args');\nconst clone = require('tricks/object/clone');\nconst closeWindow = require('tricks/window/close');\nconst createUrl = require('tricks/string/createUrl');\nconst diffKey = require('tricks/object/diffKey');\nconst diff = require('tricks/array/diff');\nconst extend = require('tricks/object/extend');\nconst globalCallback = require('tricks/events/globalCallback');\nconst iframe = require('tricks/dom/hiddenFrame');\nconst isEmpty = require('tricks/object/isEmpty');\nconst merge = require('tricks/object/merge');\nconst param = require('tricks/string/queryparse');\nconst popup = require('tricks/window/popup');\nconst pubsub = require('tricks/object/pubsub');\nconst random = require('tricks/string/random');\nconst request = require('tricks/http/request');\nconst store = require('tricks/browser/agent/localStorage');\nconst unique = require('tricks/array/unique');\nconst Url = require('tricks/window/url');\nconst Until = require('tricks/object/until');\n\nconst hello = function(name) {\n\treturn hello.use(name);\n};\n\nmodule.exports = hello;\n\nextend(hello, {\n\n\tsettings: {\n\n\t\t// OAuth2 authentication defaults\n\t\tredirect_uri: (typeof location !== 'undefined' ? location.href.split('#')[0] : null),\n\t\tresponse_type: 'token',\n\t\tdisplay: 'popup',\n\t\tstate: '',\n\n\t\t// OAuth1 shim\n\t\t// The path to the OAuth1 server for signing user requests\n\t\t// Want to recreate your own? Checkout https://github.com/MrSwitch/node-oauth-shim\n\t\toauth_proxy: 'https://auth-server.herokuapp.com/proxy',\n\n\t\t// API timeout in milliseconds\n\t\ttimeout: 20000,\n\n\t\t// Popup Options\n\t\tpopup: {\n\t\t\tresizable: 1,\n\t\t\tscrollbars: 1,\n\t\t\twidth: 500,\n\t\t\theight: 550\n\t\t},\n\n\t\t// Default scope\n\t\t// Many services require atleast a profile scope,\n\t\t// HelloJS automatially includes the value of provider.scope_map.basic\n\t\t// If that's not required it can be removed via hello.settings.scope.length = 0;\n\t\tscope: ['basic'],\n\n\t\t// Scope Maps\n\t\t// This is the default module scope, these are the defaults which each service is mapped too.\n\t\t// By including them here it prevents the scope from being applied accidentally\n\t\tscope_map: {\n\t\t\tbasic: ''\n\t\t},\n\n\t\t// Default service / network\n\t\tdefault_service: null,\n\n\t\t// Force authentication\n\t\t// When hello.login is fired.\n\t\t// (null): ignore current session expiry and continue with login\n\t\t// (true): ignore current session expiry and continue with login, ask for user to reauthenticate\n\t\t// (false): if the current session looks good for the request scopes return the current session.\n\t\tforce: null,\n\n\t\t// Page URL\n\t\t// When 'display=page' this property defines where the users page should end up after redirect_uri\n\t\t// Ths could be problematic if the redirect_uri is indeed the final place,\n\t\t// Typically this circumvents the problem of the redirect_url being a dumb relay page.\n\t\tpage_uri: (typeof location !== 'undefined' ? location.href : null)\n\t},\n\n\t// Service configuration objects\n\tservices: {},\n\n\t// Use\n\t// Define a new instance of the HelloJS library with a default service\n\tuse(service) {\n\n\t\t// Create self, which inherits from its parent\n\t\tconst self = Object.create(this);\n\n\t\t// Inherit the prototype from its parent\n\t\tself.settings = Object.create(this.settings);\n\n\t\t// Define the default service\n\t\tif (service) {\n\t\t\tself.settings.default_service = service;\n\t\t}\n\n\t\t// Create an instance of Events\n\t\tpubsub.call(self);\n\n\t\treturn self;\n\t},\n\n\t// Initialize\n\t// Define the client_ids for the endpoint services\n\t// @param object o, contains a key value pair, service => clientId\n\t// @param object opts, contains a key value pair of options used for defining the authentication defaults\n\t// @param number timeout, timeout in seconds\n\tinit(services, options) {\n\n\t\tif (!services) {\n\t\t\treturn this.services;\n\t\t}\n\n\t\t// Define provider credentials\n\t\t// Reformat the ID field\n\t\tfor (const x in services) {\n\t\t\tif (services.hasOwnProperty(x)) {\n\t\t\t\tif (typeof (services[x]) !== 'object') {\n\t\t\t\t\tservices[x] = {id: services[x]};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Merge services if there already exists some\n\t\textend(this.services, services);\n\n\t\t// Update the default settings with this one.\n\t\tif (options) {\n\t\t\textend(this.settings, options);\n\n\t\t\t// Do this immediatly incase the browser changes the current path.\n\t\t\tif ('redirect_uri' in options) {\n\t\t\t\tthis.settings.redirect_uri = Url(options.redirect_uri).href;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t// Login\n\t// Using the endpoint\n\t// @param network stringify       name to connect to\n\t// @param options object    (optional)  {display mode, is either none|popup(default)|page, scope: email,birthday,publish, .. }\n\t// @param callback  function  (optional)  fired on signin\n\tasync login(...args) {\n\n\t\tconst utils = this.utils;\n\t\t// Get parameters\n\t\tconst p = argmap({network: 's', options: 'o', callback: 'f'}, args);\n\n\t\t// Local vars\n\t\tlet url;\n\n\t\t// Get all the custom options and store to be appended to the querystring\n\t\tconst qs = diffKey(p.options, this.settings);\n\n\t\t// Merge/override options with app defaults\n\t\tconst opts = p.options = merge(this.settings, p.options || {});\n\n\t\t// Merge/override options with app defaults\n\t\topts.popup = merge(this.settings.popup, p.options.popup || {});\n\n\t\t// Network\n\t\tp.network = p.network || this.settings.default_service;\n\n\t\t// Is our service valid?\n\t\tif (typeof (p.network) !== 'string' || !(p.network in this.services)) {\n\t\t\t// Trigger the default login.\n\t\t\t// Ahh we dont have one.\n\t\t\tthrow error('invalid_network', 'The provided network was not recognized');\n\t\t}\n\n\t\tconst provider = this.services[p.network];\n\n\t\t// Create a global listener to capture events triggered out of scope\n\t\tconst callbackId = `_hellojs_${random()}`;\n\n\t\tconst prs = [];\n\n\t\tprs.push(new Promise((accept, reject) => {\n\t\t\tglobalCallback(str => {\n\n\t\t\t\t// The responseHandler returns a string, lets save this locally\n\t\t\t\tlet obj;\n\n\t\t\t\tif (str) {\n\t\t\t\t\tobj = JSON.parse(str);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tobj = error('cancelled', 'The authentication was not completed');\n\t\t\t\t}\n\n\t\t\t\t// Handle these response using the local\n\t\t\t\t// Trigger on the parent\n\t\t\t\tif (!obj.error) {\n\n\t\t\t\t\t// Save on the parent window the new credentials\n\t\t\t\t\t// This fixes an IE10 bug i think... atleast it does for me.\n\t\t\t\t\tutils.store(obj.network, obj);\n\n\t\t\t\t\t// Fulfill a successful login\n\t\t\t\t\taccept({\n\t\t\t\t\t\tnetwork: obj.network,\n\t\t\t\t\t\tauthResponse: obj\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Reject a successful login\n\t\t\t\t\treject(obj);\n\t\t\t\t}\n\t\t\t}, callbackId);\n\t\t}));\n\n\t\tconst redirectUri = Url(opts.redirect_uri).href;\n\n\t\t// May be a space-delimited list of multiple, complementary types\n\t\tlet responseType = provider.oauth.response_type || opts.response_type;\n\n\t\t// Fallback to token if the module hasn't defined a grant url\n\t\tif (/\\bcode\\b/.test(responseType) && !provider.oauth.grant) {\n\t\t\tresponseType = responseType.replace(/\\bcode\\b/, 'token');\n\t\t}\n\n\t\t// Query string parameters, we may pass our own arguments to form the querystring\n\t\tp.qs = merge(qs, {\n\t\t\tclient_id: encodeURIComponent(provider.id),\n\t\t\tresponse_type: encodeURIComponent(responseType),\n\t\t\tredirect_uri: encodeURIComponent(redirectUri),\n\t\t\tstate: {\n\t\t\t\tclient_id: provider.id,\n\t\t\t\tnetwork: p.network,\n\t\t\t\tdisplay: opts.display,\n\t\t\t\tcallback: callbackId,\n\t\t\t\tstate: opts.state,\n\t\t\t\tredirect_uri: redirectUri\n\t\t\t}\n\t\t});\n\n\t\t// Get current session for merging scopes, and for quick auth response\n\t\tconst session = utils.store(p.network);\n\n\t\t// Scopes (authentication permisions)\n\t\t// Ensure this is a string - IE has a problem moving Arrays between windows\n\t\t// Append the setup scope\n\t\tconst SCOPE_SPLIT = /[,\\s]+/;\n\n\t\t// Include default scope settings (cloned).\n\t\tlet scope = this.settings.scope ? [this.settings.scope.toString()] : [];\n\n\t\t// Extend the providers scope list with the default\n\t\tconst scopeMap = merge(this.settings.scope_map, provider.scope || {});\n\n\t\t// Add user defined scopes...\n\t\tif (opts.scope) {\n\t\t\tscope.push(opts.scope.toString());\n\t\t}\n\n\t\t// Append scopes from a previous session.\n\t\t// This helps keep app credentials constant,\n\t\t// Avoiding having to keep tabs on what scopes are authorized\n\t\tif (session && 'scope' in session && session.scope instanceof String) {\n\t\t\tscope.push(session.scope);\n\t\t}\n\n\t\t// Join and Split again\n\t\tscope = scope.join(',').split(SCOPE_SPLIT);\n\n\t\t// Format remove duplicates and empty values\n\t\tscope = unique(scope).filter(filterEmpty);\n\n\t\t// Save the the scopes to the state with the names that they were requested with.\n\t\tp.qs.state.scope = scope.join(',');\n\n\t\t// Map scopes to the providers naming convention\n\t\t// Does this have a mapping?\n\t\tscope = scope.map(item => ((item in scopeMap) ? scopeMap[item] : item));\n\n\t\t// Stringify and Arrayify so that double mapped scopes are given the chance to be formatted\n\t\tscope = scope.join(',').split(SCOPE_SPLIT);\n\n\t\t// Again...\n\t\t// Format remove duplicates and empty values\n\t\tscope = unique(scope).filter(filterEmpty);\n\n\t\t// Join with the expected scope delimiter into a string\n\t\tp.qs.scope = scope.join(provider.scope_delim || ',');\n\n\t\t// Is the user already signed in with the appropriate scopes, valid access_token?\n\t\tif (opts.force === false) {\n\n\t\t\tif (session && 'access_token' in session && session.access_token && 'expires' in session && session.expires > ((new Date()).getTime() / 1e3)) {\n\t\t\t\t// What is different about the scopes in the session vs the scopes in the new login?\n\t\t\t\tconst a = diff((session.scope || '').split(SCOPE_SPLIT), (p.qs.state.scope || '').split(SCOPE_SPLIT));\n\t\t\t\tif (a.length === 0) {\n\n\t\t\t\t\t// OK trigger the callback\n\t\t\t\t\treturn {\n\t\t\t\t\t\tunchanged: true,\n\t\t\t\t\t\tnetwork: p.network,\n\t\t\t\t\t\tauthResponse: session\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Page URL\n\t\tif (opts.display === 'page' && opts.page_uri) {\n\t\t\t// Add a page location, place to endup after session has authenticated\n\t\t\tp.qs.state.page_uri = Url(opts.page_uri).href;\n\t\t}\n\n\t\t// Bespoke\n\t\t// Override login querystrings from auth_options\n\t\tif ('login' in provider && typeof (provider.login) === 'function') {\n\t\t\t// Format the paramaters according to the providers formatting function\n\t\t\tprovider.login(p);\n\t\t}\n\n\t\t// Add OAuth to state\n\t\t// Where the service is going to take advantage of the oauth_proxy\n\t\tif (!/\\btoken\\b/.test(responseType) ||\n\t\tparseInt(provider.oauth.version, 10) < 2 ||\n\t\t(opts.display === 'none' && provider.oauth.grant && session && session.refresh_token)) {\n\n\t\t\t// Add the oauth endpoints\n\t\t\tp.qs.state.oauth = provider.oauth;\n\n\t\t\t// Add the proxy url\n\t\t\tp.qs.state.oauth_proxy = opts.oauth_proxy;\n\n\t\t}\n\n\t\t// Convert state to a string\n\t\tp.qs.state = encodeURIComponent(JSON.stringify(p.qs.state));\n\n\t\t// URL\n\t\tif (parseInt(provider.oauth.version, 10) === 1) {\n\n\t\t\t// Turn the request to the OAuth Proxy for 3-legged auth\n\t\t\turl = createUrl(opts.oauth_proxy, p.qs, encodeFunction);\n\t\t}\n\n\t\t// Refresh token\n\t\telse if (opts.display === 'none' && provider.oauth.grant && session && session.refresh_token) {\n\n\t\t\t// Add the refresh_token to the request\n\t\t\tp.qs.refresh_token = session.refresh_token;\n\n\t\t\t// Define the request path\n\t\t\turl = createUrl(opts.oauth_proxy, p.qs, encodeFunction);\n\t\t}\n\t\telse {\n\t\t\turl = createUrl(provider.oauth.auth, p.qs, encodeFunction);\n\t\t}\n\n\t\t// Broadcast this event as an auth:init\n\t\temit('auth.init', p);\n\n\t\t// Execute\n\t\t// Trigger how we want self displayed\n\t\tif (opts.display === 'none') {\n\t\t\t// Sign-in in the background, iframe\n\t\t\tutils.iframe(url, redirectUri);\n\t\t}\n\n\t\t// Triggering popup?\n\t\telse if (opts.display === 'popup') {\n\n\t\t\tconst win = utils.popup(url, redirectUri, opts.popup);\n\n\t\t\t// Monitor the state of the popup...\n\t\t\tprs.push(Until((accept, reject) => {\n\t\t\t\tif (!win || win.closed) {\n\n\t\t\t\t\tlet response = error('cancelled', 'Login has been cancelled');\n\n\t\t\t\t\tif (!popup) {\n\t\t\t\t\t\tresponse = error('blocked', 'Popup was blocked');\n\t\t\t\t\t}\n\n\t\t\t\t\tresponse.network = p.network;\n\n\t\t\t\t\treject(response);\n\t\t\t\t}\n\t\t\t}, 100));\n\t\t}\n\n\t\telse {\n\t\t\twindow.location = url;\n\t\t}\n\n\t\tfunction encodeFunction(s) {\n\t\t\treturn s;\n\t\t}\n\n\t\tfunction filterEmpty(s) {\n\t\t\treturn !!s;\n\t\t}\n\n\t\t// Return the first success or failure...\n\t\tconst promise = Promise.race(prs);\n\n\t\t// Bind callback to both reject and fulfill states\n\t\tpromise.then(p.callback, p.callback);\n\n\t\t// Trigger an event on the global listener\n\t\tfunction emit(s, value) {\n\t\t\thello.emit(s, value);\n\t\t}\n\n\t\tpromise.then(emit.bind(this, 'auth.login auth'), emit.bind(this, 'auth.failed auth'));\n\n\t\treturn promise;\n\t},\n\n\t// Remove any data associated with a given service\n\t// @param string name of the service\n\t// @param function callback\n\tasync logout(...args) {\n\n\t\tconst utils = this.utils;\n\n\t\tconst p = argmap({name: 's', options: 'o', callback: 'f'}, args);\n\n\t\tconst prs = [];\n\n\t\tp.options = p.options || {};\n\n\t\t// Network\n\t\tp.name = p.name || this.settings.default_service;\n\t\tp.authResponse = utils.store(p.name);\n\n\t\tif (p.name && !(p.name in this.services)) {\n\n\t\t\tthrow error('invalid_network', 'The network was unrecognized');\n\n\t\t}\n\t\telse if (p.name && p.authResponse) {\n\n\t\t\tconst promiseLogout = new Promise(accept => {\n\t\t\t\t// Run an async operation to remove the users session\n\t\t\t\tconst _opts = {};\n\n\t\t\t\tif (p.options.force) {\n\t\t\t\t\tlet logout = this.services[p.name].logout;\n\t\t\t\t\tif (logout) {\n\t\t\t\t\t\t// Convert logout to URL string,\n\t\t\t\t\t\t// If no string is returned, then this function will handle the logout async style\n\t\t\t\t\t\tif (typeof (logout) === 'function') {\n\t\t\t\t\t\t\tlogout = logout(accept, p);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If logout is a string then assume URL and open in iframe.\n\t\t\t\t\t\tif (typeof (logout) === 'string') {\n\t\t\t\t\t\t\tutils.iframe(logout);\n\t\t\t\t\t\t\t_opts.force = null;\n\t\t\t\t\t\t\t_opts.message = 'Logout success on providers site was indeterminate';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (logout === undefined) {\n\t\t\t\t\t\t\t// The callback function will handle the response.\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\taccept(_opts);\n\t\t\t})\n\t\t\t\t.then(opts => {\n\n\t\t\t\t\t// Remove from the store\n\t\t\t\t\tutils.store(p.name, null);\n\n\t\t\t\t\t// Emit events by default\n\t\t\t\t\treturn merge({\n\t\t\t\t\t\tnetwork: p.name\n\t\t\t\t\t}, opts || {});\n\t\t\t\t});\n\n\t\t\tprs.push(promiseLogout);\n\n\t\t}\n\t\telse {\n\t\t\tthrow error('invalid_session', 'There was no session to remove');\n\t\t}\n\n\t\t// Promse\n\t\tconst promise = Promise.race(prs);\n\n\t\t// Add callback to events\n\t\tpromise.then(p.callback, p.callback);\n\n\t\t// Trigger an event on the global listener\n\t\tpromise.then(\n\t\t\tvalue => hello.emit('auth.logout auth', value),\n\t\t\terr => hello.emit('error', err)\n\t\t);\n\n\t\treturn promise;\n\t},\n\n\t// Returns all the sessions that are subscribed too\n\t// @param string optional, name of the service to get information about.\n\tgetAuthResponse(service) {\n\n\t\t// If the service doesn't exist\n\t\tservice = service || this.settings.default_service;\n\n\t\tif (!service || !(service in this.services)) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.utils.store(service) || null;\n\t},\n\n\t// Events: placeholder for the events\n\tevents: {}\n});\n\nfunction error(code, message) {\n\treturn {\n\t\terror: {\n\t\t\tcode,\n\t\t\tmessage\n\t\t}\n\t};\n}\n\nhello.utils = {\n\tiframe,\n\tpopup,\n\trequest,\n\tstore\n};\n\n// Core utilities\nextend(hello.utils, {\n\n\t// OAuth and API response handler\n\tresponseHandler(window, parent) {\n\t\tconst utils = this;\n\n\t\tlet p;\n\t\tconst location = window.location;\n\n\t\tconst redirect = (location.assign && location.assign.bind(location)) || (url => {\n\t\t\twindow.location = url;\n\t\t});\n\n\t\t// Is this an auth relay message which needs to call the proxy?\n\t\tp = param(location.search);\n\n\t\t// OAuth2 or OAuth1 server response?\n\t\tif (p && p.state && (p.code || p.oauth_token)) {\n\n\t\t\tconst state = JSON.parse(p.state);\n\n\t\t\t// Add this path as the redirect_uri\n\t\t\tp.redirect_uri = state.redirect_uri || location.href.replace(/[?#].*$/, '');\n\n\t\t\t// Redirect to the host\n\t\t\tconst path = `${state.oauth_proxy}?${param(p)}`;\n\n\t\t\tredirect(path);\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Save session, from redirected authentication\n\t\t// #access_token has come in?\n\t\t//\n\t\t// FACEBOOK is returning auth errors within as a query_string... thats a stickler for consistency.\n\t\t// SoundCloud is the state in the querystring and the token in the hashtag, so we'll mix the two together\n\n\t\tp = merge(param(location.search || ''), param(location.hash || ''));\n\n\t\t// If p.state\n\t\tif (p && 'state' in p) {\n\n\t\t\t// Remove any addition information\n\t\t\t// E.g. p.state = 'facebook.page';\n\t\t\ttry {\n\t\t\t\tconst a = JSON.parse(p.state);\n\t\t\t\textend(p, a);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\thello.emit('error', 'Could not decode state parameter');\n\t\t\t}\n\n\t\t\t// Access_token?\n\t\t\tif (('access_token' in p && p.access_token) && p.network) {\n\n\t\t\t\tif (!p.expires_in || parseInt(p.expires_in, 10) === 0) {\n\t\t\t\t\t// If p.expires_in is unset, set to 0\n\t\t\t\t\tp.expires_in = 0;\n\t\t\t\t}\n\n\t\t\t\tp.expires_in = parseInt(p.expires_in, 10);\n\t\t\t\tp.expires = ((new Date()).getTime() / 1e3) + (p.expires_in || (60 * 60 * 24 * 365));\n\n\t\t\t\t// Lets use the \"state\" to assign it to one of our networks\n\t\t\t\tauthCallback(p, window, parent);\n\t\t\t}\n\n\t\t\t// Error=?\n\t\t\t// &error_description=?\n\t\t\t// &state=?\n\t\t\telse if (('error' in p && p.error) && p.network) {\n\n\t\t\t\tp.error = {\n\t\t\t\t\tcode: p.error,\n\t\t\t\t\tmessage: p.error_message || p.error_description\n\t\t\t\t};\n\n\t\t\t\t// Let the state handler handle it\n\t\t\t\tauthCallback(p, window, parent);\n\t\t\t}\n\n\t\t\t// API call, or a cancelled login\n\t\t\t// Result is serialized JSON string\n\t\t\telse if (p.callback && p.callback in parent) {\n\n\t\t\t\t// Trigger a function in the parent\n\t\t\t\tconst res = 'result' in p && p.result ? JSON.parse(p.result) : false;\n\n\t\t\t\t// Trigger the callback on the parent\n\t\t\t\tcallback(parent, p.callback)(res);\n\t\t\t\tcloseWindow(window);\n\t\t\t}\n\n\t\t\t// If this page is still open\n\t\t\tif (p.page_uri) {\n\t\t\t\tredirect(p.page_uri);\n\t\t\t}\n\t\t}\n\n\t\t// OAuth redirect, fixes URI fragments from being lost in Safari\n\t\t// (URI Fragments within 302 Location URI are lost over HTTPS)\n\t\t// Loading the redirect.html before triggering the OAuth Flow seems to fix it.\n\t\telse if ('oauth_redirect' in p) {\n\n\t\t\tredirect(decodeURIComponent(p.oauth_redirect));\n\t\t\treturn;\n\t\t}\n\n\t\t// Trigger a callback to authenticate\n\t\tfunction authCallback(obj, window, parent) {\n\n\t\t\tconst cb = obj.callback;\n\t\t\tconst network = obj.network;\n\n\t\t\t// Trigger the callback on the parent\n\t\t\tutils.store(network, obj);\n\n\t\t\t// If this is a page request it has no parent or opener window to handle callbacks\n\t\t\tif (('display' in obj) && obj.display === 'page') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Remove from session object\n\t\t\tif (parent && cb && cb in parent) {\n\n\t\t\t\ttry {\n\t\t\t\t\tdelete obj.callback;\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\t// continue\n\t\t\t\t}\n\n\t\t\t\t// Update store\n\t\t\t\tutils.store(network, obj);\n\n\t\t\t\t// Call the globalEvent function on the parent\n\t\t\t\t// It's safer to pass back a string to the parent,\n\t\t\t\t// Rather than an object/array (better for IE8)\n\t\t\t\tconst str = JSON.stringify(obj);\n\n\t\t\t\ttry {\n\t\t\t\t\tcallback(parent, cb)(str);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\t// Error thrown whilst executing parent callback\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcloseWindow(window);\n\t\t}\n\n\t\tfunction callback(parent, callbackID) {\n\t\t\tif (callbackID.indexOf('_hellojs_') !== 0) {\n\t\t\t\treturn function() {\n\t\t\t\t\tthrow `Could not execute callback ${callbackID}`;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn parent[callbackID];\n\t\t}\n\t}\n});\n\n\n// Events\n// Extend the hello object with its own event instance\npubsub.call(hello);\n\n///////////////////////////////////\n// Monitoring session state\n// Check for session changes\n///////////////////////////////////\n\n(function(hello) {\n\n\t// Monitor for a change in state and fire\n\tconst oldSessions = {};\n\n\t// Hash of expired tokens\n\tconst expired = {};\n\n\t// Listen to other triggers to Auth events, use these to update this\n\thello.on('auth.login, auth.logout', auth => {\n\t\tif (auth && typeof (auth) === 'object' && auth.network) {\n\t\t\toldSessions[auth.network] = hello.utils.store(auth.network) || {};\n\t\t}\n\t});\n\n\t(function self() {\n\n\t\tconst CURRENT_TIME = ((new Date()).getTime() / 1e3);\n\n\t\t// Loop through the services\n\t\tfor (const name in hello.services) {\n\t\t\tif (hello.services.hasOwnProperty(name)) {\n\n\t\t\t\tif (!hello.services[name].id) {\n\t\t\t\t// We haven't attached an ID so dont listen.\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Get session\n\t\t\t\tconst session = hello.utils.store(name) || {};\n\t\t\t\tconst provider = hello.services[name];\n\t\t\t\tconst oldSess = oldSessions[name] || {};\n\n\t\t\t\tconst emit = function(eventName) {\n\t\t\t\t\thello.emit(`auth.${eventName}`, {\n\t\t\t\t\t\tnetwork: name,\n\t\t\t\t\t\tauthResponse: session\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\t// Listen for globalEvents that did not get triggered from the child\n\t\t\t\tif (session && 'callback' in session) {\n\n\t\t\t\t\t// To do remove from session object...\n\t\t\t\t\tconst cb = session.callback;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdelete session.callback;\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\t// Continue\n\t\t\t\t\t}\n\n\t\t\t\t\t// Update store\n\t\t\t\t\t// Removing the callback\n\t\t\t\t\thello.utils.store(name, session);\n\n\t\t\t\t\t// Emit global events\n\t\t\t\t\ttry {\n\t\t\t\t\t\twindow[cb](session);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\t// Continue\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Refresh token\n\t\t\t\tif (session && ('expires' in session) && session.expires < CURRENT_TIME) {\n\n\t\t\t\t\t// If auto refresh is possible\n\t\t\t\t\t// Either the browser supports\n\t\t\t\t\tconst refresh = provider.refresh || session.refresh_token;\n\n\t\t\t\t\t// Has the refresh been run recently?\n\t\t\t\t\tif (refresh && (!(name in expired) || expired[name] < CURRENT_TIME)) {\n\t\t\t\t\t\t// Try to resignin\n\t\t\t\t\t\thello.emit('notice', `${name} has expired trying to resignin`);\n\t\t\t\t\t\thello.login(name, {display: 'none', force: false});\n\n\t\t\t\t\t\t// Update expired, every 10 minutes\n\t\t\t\t\t\texpired[name] = CURRENT_TIME + 600;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Does this provider not support refresh\n\t\t\t\t\telse if (!refresh && !(name in expired)) {\n\t\t\t\t\t// Label the event\n\t\t\t\t\t\temit('expired');\n\t\t\t\t\t\texpired[name] = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If session has expired then we dont want to store its value until it can be established that its been updated\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Has session changed?\n\t\t\t\telse if (oldSess.access_token === session.access_token &&\n\t\t\toldSess.expires === session.expires) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Access_token has been removed\n\t\t\t\telse if (!session.access_token && oldSess.access_token) {\n\t\t\t\t\temit('logout');\n\t\t\t\t}\n\n\t\t\t\t// Access_token has been created\n\t\t\t\telse if (session.access_token && !oldSess.access_token) {\n\t\t\t\t\temit('login');\n\t\t\t\t}\n\n\t\t\t\t// Access_token has been updated\n\t\t\t\telse if (session.expires !== oldSess.expires) {\n\t\t\t\t\temit('update');\n\t\t\t\t}\n\n\t\t\t\t// Updated stored session\n\t\t\t\toldSessions[name] = session;\n\n\t\t\t\t// Remove the expired flags\n\t\t\t\tif (name in expired) {\n\t\t\t\t\tdelete expired[name];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Check error events\n\t\tsetTimeout(self, 1000);\n\t})();\n\n})(hello);\n\n// EOF CORE lib\n//////////////////////////////////\n\n/////////////////////////////////////////\n// API\n// @param path    string\n// @param query   object (optional)\n// @param method  string (optional)\n// @param data    object (optional)\n// @param timeout integer (optional)\n// @param callback  function (optional)\n\nhello.api = async function(...args) {\n\n\t// Arguments\n\tconst p = argmap({path: 's!', query: 'o', method: 's', data: 'o', timeout: 'i', callback: 'f'}, args);\n\n\t// Remove the network from path, e.g. facebook:/me/friends\n\t// Results in { network : facebook, path : me/friends }\n\tif (!p || !p.path) {\n\t\tthrow error('invalid_path', 'Missing the path parameter from the request');\n\t}\n\n\t// Method\n\tp.method = (p.method || 'get').toLowerCase();\n\n\t// Headers\n\tp.headers = p.headers || {};\n\n\t// Response format\n\tp.responseType = p.responseType || 'json';\n\n\t// Query\n\tp.query = p.query || {};\n\n\t// If get, put all parameters into query\n\tif (p.method === 'get' || p.method === 'delete') {\n\t\textend(p.query, p.data);\n\t\tp.data = {};\n\t}\n\n\tconst data = p.data = p.data || {};\n\n\tp.path = p.path.replace(/^\\/+/, '');\n\tconst a = (p.path.split(/[/:]/, 2) || [])[0].toLowerCase();\n\n\tif (a in this.services) {\n\t\tp.network = a;\n\t\tconst reg = new RegExp(`^${a}:?/?`);\n\t\tp.path = p.path.replace(reg, '');\n\t}\n\n\t// Network & Provider\n\t// Define the network that this request is made for\n\tp.network = this.settings.default_service = p.network || this.settings.default_service;\n\tconst o = this.services[p.network];\n\n\t// INVALID\n\t// Is there no service by the given network name?\n\tif (!o) {\n\t\tthrow error('invalid_network', `Could not match the service requested: ${  p.network}`);\n\t}\n\n\t// PATH\n\t// As long as the path isn't flagged as unavaiable, e.g. path == false\n\n\tif (!(!(p.method in o) || !(p.path in o[p.method]) || o[p.method][p.path] !== false)) {\n\t\tthrow error('invalid_path', 'The provided path is not available on the selected network');\n\t}\n\n\t// PROXY\n\t// OAuth1 calls always need a proxy\n\n\tif (!p.oauth_proxy) {\n\t\tp.oauth_proxy = this.settings.oauth_proxy;\n\t}\n\n\tif (!('proxy' in p)) {\n\t\tp.proxy = p.oauth_proxy && o.oauth && parseInt(o.oauth.version, 10) === 1;\n\t}\n\n\t// TIMEOUT\n\t// Adopt timeout from global settings by default\n\n\tif (!('timeout' in p)) {\n\t\tp.timeout = this.settings.timeout;\n\t}\n\n\t// Format response\n\t// Whether to run the raw response through post processing.\n\tif (!('formatResponse' in p)) {\n\t\tp.formatResponse = true;\n\t}\n\n\t// Get the current session\n\t// Append the access_token to the query\n\tp.authResponse = this.getAuthResponse(p.network);\n\tif (p.authResponse && p.authResponse.access_token) {\n\t\tp.query.access_token = p.authResponse.access_token;\n\t}\n\n\tlet url = p.path;\n\tlet m;\n\n\t// Store the query as options\n\t// This is used to populate the request object before the data is augmented by the prewrap handlers.\n\tp.options = clone(p.query);\n\n\t// Clone the data object\n\t// Prevent this script overwriting the data of the incoming object.\n\t// Ensure that everytime we run an iteration the callbacks haven't removed some data\n\tp.data = clone(data);\n\n\t// URL Mapping\n\t// Is there a map for the given URL?\n\tconst actions = o[{delete: 'del'}[p.method] || p.method] || {};\n\n\t// Extrapolate the QueryString\n\t// Provide a clean path\n\t// Move the querystring into the data\n\tif (p.method === 'get') {\n\n\t\tconst query = url.split(/[?#]/)[1];\n\t\tif (query) {\n\t\t\textend(p.query, param(query));\n\n\t\t\t// Remove the query part from the URL\n\t\t\turl = url.replace(/\\?.*?(#|$)/, '$1');\n\t\t}\n\t}\n\n\t// Is the hash fragment defined\n\tif ((m = url.match(/#(.+)/, ''))) {\n\t\turl = url.split('#')[0];\n\t\tp.path = m[1];\n\t}\n\telse if (url in actions) {\n\t\tp.path = url;\n\t\turl = actions[url];\n\t}\n\telse if ('default' in actions) {\n\t\turl = actions.default;\n\t}\n\n\t// Redirect Handler\n\t// This defines for the Form+Iframe+Hash hack where to return the results too.\n\tp.redirect_uri = this.settings.redirect_uri;\n\n\t// Define FormatHandler\n\t// The request can be procesed in a multitude of ways\n\t// Here's the options - depending on the browser and endpoint\n\tp.xhr = o.xhr;\n\tp.jsonp = o.jsonp;\n\tp.form = o.form;\n\n\t// Define Proxy handler\n\tp.proxyHandler = (p, callback) => {\n\n\t\t// Are we signing the request?\n\t\tlet sign;\n\n\t\t// OAuth1\n\t\t// Remove the token from the query before signing\n\t\tif (p.authResponse && p.authResponse.oauth && parseInt(p.authResponse.oauth.version, 10) === 1) {\n\n\t\t\t// OAUTH SIGNING PROXY\n\t\t\tsign = p.query.access_token;\n\n\t\t\t// Remove the access_token\n\t\t\tdelete p.query.access_token;\n\n\t\t\t// Enfore use of Proxy\n\t\t\tp.proxy = true;\n\t\t}\n\n\t\t// POST body to querystring\n\t\tif (p.data && (p.method === 'get' || p.method === 'delete')) {\n\t\t\t// Attach the p.data to the querystring.\n\t\t\textend(p.query, p.data);\n\t\t\tp.data = null;\n\t\t}\n\n\t\t// Construct the path\n\t\tlet path = createUrl(p.url, p.query);\n\n\t\t// Proxy the request through a server\n\t\t// Used for signing OAuth1\n\t\t// And circumventing services without Access-Control Headers\n\t\tif (p.proxy) {\n\t\t\t// Use the proxy as a path\n\t\t\tpath = createUrl(p.oauth_proxy, {\n\t\t\t\tpath,\n\t\t\t\taccess_token: sign || '',\n\n\t\t\t\t// This will prompt the request to be signed as though it is OAuth1\n\t\t\t\tthen: p.proxy_response_type || (p.method.toLowerCase() === 'get' ? 'redirect' : 'proxy'),\n\t\t\t\tmethod: p.method.toLowerCase(),\n\t\t\t\tsuppress_response_codes: true\n\t\t\t});\n\t\t}\n\n\t\tcallback(path);\n\t};\n\n\n\t// If url needs a base\n\t// Wrap everything in\n\n\tlet promise;\n\n\t// Make request\n\tif (typeof (url) === 'function') {\n\t\t// Does self have its own callback?\n\t\tpromise = new Promise(accept => url(p, accept));\n\t}\n\telse {\n\t\t// Else the URL is a string\n\t\tpromise = Promise.resolve(url);\n\t}\n\n\t// Handle the url...\n\tpromise = promise.then(url => {\n\n\t\t// Format the string if it needs it\n\t\turl = url.replace(/@\\{([a-z_-]+)(\\|.*?)?\\}/gi, (m, key, defaults) => {\n\t\t\tlet val = defaults ? defaults.replace(/^\\|/, '') : '';\n\t\t\tif (key in p.query) {\n\t\t\t\tval = p.query[key];\n\t\t\t\tdelete p.query[key];\n\t\t\t}\n\t\t\telse if (p.data && key in p.data) {\n\t\t\t\tval = p.data[key];\n\t\t\t\tdelete p.data[key];\n\t\t\t}\n\t\t\telse if (!defaults) {\n\t\t\t\tthrow error('missing_attribute', `The attribute ${  key  } is missing from the request`);\n\t\t\t}\n\n\t\t\treturn val;\n\t\t});\n\n\t\t// Add base\n\t\tif (!url.match(/^https?:\\/\\//)) {\n\t\t\turl = o.base + url;\n\t\t}\n\n\t\t// Define the request URL\n\t\tp.url = url;\n\n\t\t// Make the HTTP request with the curated request object\n\t\t// CALLBACK HANDLER\n\t\t// @ response object\n\t\t// @ statusCode integer if available\n\t\treturn new Promise(accept => this.utils.request(p, (data, headers) => accept({data, headers})));\n\n\t})\n\t\t.then(resp => {\n\n\t\t\tlet {data} = resp;\n\t\t\tconst {headers} = resp;\n\n\t\t\t// Is this a raw response?\n\t\t\tif (!p.formatResponse) {\n\t\t\t\t// Bad request? error statusCode or otherwise contains an error response vis JSONP?\n\t\t\t\tif (typeof headers === 'object' ? (headers.statusCode >= 400) : (typeof r === 'object' && 'error' in data)) {\n\t\t\t\t\tthrow data;\n\t\t\t\t}\n\n\t\t\t\treturn data;\n\t\t\t}\n\n\t\t\t// Should this be an object\n\t\t\tif (data === true) {\n\t\t\t\tdata = {success: true};\n\t\t\t}\n\n\t\t\t// The delete callback needs a better response\n\t\t\tif (p.method === 'delete') {\n\t\t\t\tdata = (!data || isEmpty(data)) ? {success: true} : data;\n\t\t\t}\n\n\t\t\t// FORMAT RESPONSE?\n\t\t\t// Does self request have a corresponding formatter\n\t\t\tif (o.wrap && ((p.path in o.wrap) || ('default' in o.wrap))) {\n\t\t\t\tconst wrap = (p.path in o.wrap ? p.path : 'default');\n\n\t\t\t\t// FORMAT RESPONSE\n\t\t\t\tconst b = o.wrap[wrap](data, headers, p);\n\n\t\t\t\t// Has the response been utterly overwritten?\n\t\t\t\t// Typically self augments the existing object.. but for those rare occassions\n\t\t\t\tif (b) {\n\t\t\t\t\tdata = b;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Is there a next_page defined in the response?\n\t\t\tif (data && 'paging' in data && data.paging.next) {\n\n\t\t\t\t// Add the relative path if it is missing from the paging/next path\n\t\t\t\tif (data.paging.next[0] === '?') {\n\t\t\t\t\tdata.paging.next = p.path + data.paging.next;\n\t\t\t\t}\n\n\t\t\t\t// The relative path has been defined, lets markup the handler in the HashFragment\n\t\t\t\telse {\n\t\t\t\t\tdata.paging.next += `#${  p.path}`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Dispatch to listeners\n\t\t\t// Emit events which pertain to the formatted response\n\t\t\tif (!data || 'error' in data) {\n\t\t\t\tthrow data;\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn data;\n\t\t\t}\n\t\t});\n\n\t// Completed event callback\n\tpromise.then(p.callback, p.callback);\n\n\treturn promise;\n};\n\n\n/////////////////////////////////////\n//\n// Save any access token that is in the current page URL\n// Handle any response solicited through iframe hash tag following an API request\n//\n/////////////////////////////////////\n\nhello.utils.responseHandler(window, window.opener || window.parent);\n\nmodule.exports = hello;"]}